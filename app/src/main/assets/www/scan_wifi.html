<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <style>
        body{
            margin: 0;
            padding: 0;
        }
    </style>
</head>
<body>
<!--模型stl展示-->
<div id="stl_show"></div>
<script src="js/three.js"></script>
<script src="js/Detector.js"></script>
<script src="js/STLLoader.js"></script>
<script src="js/OrbitControls.js"></script>
<script src="js/TransformControls.js"></script>
<script>
    var Url = "";
    function showMessage(json){
        Url = json.url;
        console.log(Url);
        stl_init();
    }
    if ( ! Detector.webgl ) Detector.addGetWebGLMessage();
    var camera, scene, renderer,container;
    //stl_init();
    function stl_init(){
        //Url = 'http://www.geeetech.com/3d_models/public/uploads/20171101/AA_porta_pegamento_en_barra_473658.stl';
        container = document.getElementById('stl_show');
        scene = new THREE.Scene();
        scene.add( new THREE.AmbientLight( 0x999999 ) );

        camera = new THREE.PerspectiveCamera( 35, window.innerWidth / window.innerHeight, 1, 5000 );
        camera.up.set( 0, 0, 1 );
        camera.position.set( 0, 0, 300 );
        camera.add( new THREE.PointLight( 0xffffff, 0.8 ) );
        scene.add( camera );

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setClearColor( 0x999999 );
        //renderer.setPixelRatio( window.devicePixelRatio );
        renderer.setSize( window.innerWidth, window.innerHeight );
        container.appendChild( renderer.domElement );

        var loader1 = new THREE.STLLoader();
        var material = new THREE.MeshPhongMaterial( { color: 0xAAAAAA, specular: 0x111111, shininess: 200 } );
        loader1.load( Url, function ( geometry ) {       //http://192.168.0.75:8888/webroot/App/images/You_are_Beautiful.stl
            var meshMaterial = material;
            if (geometry.hasColors) {
                meshMaterial = new THREE.MeshPhongMaterial({ opacity: geometry.alpha, vertexColors: THREE.VertexColors });
            }
            geometry.center(0,0,0);
            var mesh = new THREE.Mesh( geometry, meshMaterial );
            scene.add( mesh );
            //mesh.position.set( -15, 35, 0 );
            mesh.scale.set( 0.3, 0.3, 0.3 );
            render();
        } );
        var controls = new THREE.OrbitControls( camera, renderer.domElement );
        controls.addEventListener( 'change', render );
        controls.target.set( 0, 1.2, 2 );
        controls.update();
        window.addEventListener( 'resize', onWindowResize, false );
    }
    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize( window.innerWidth, window.innerHeight );
        render();
    }
    function render() {
        renderer.render( scene, camera );
    }
</script>
</body>
</html>